:root {
  --bg: #05070e;
  --bg-2: #0a0f1f;
  --fg: #d9f7ff;
  --muted: #6aa9bb;
  --line: rgba(0, 229, 255, 0.25);
  --line-strong: rgba(0, 229, 255, 0.6);
  --primary: #00e5ff;   /* neon cyan */
  --accent: #ff2bd6;    /* neon magenta */
  --danger: #ff3864;    /* neon red */
  --panel: rgba(0, 10, 20, 0.55);
  --glow: 0 0 10px rgba(0, 229, 255, 0.35), 0 0 22px rgba(255, 43, 214, 0.15);
  --scanlines-opacity: 0.18; /* default intensity; overridable by UI */
  /* Themed scrollbar tokens */
  --sb-size: 11px;
  --sb-track: color-mix(in srgb, var(--bg-2) 80%, transparent);
  --sb-thumb: color-mix(in srgb, var(--primary) 35%, var(--bg-2));
  --sb-thumb-hover: color-mix(in srgb, var(--primary) 65%, var(--bg-2));
  --sb-thumb-active: var(--primary);
}

/* Theme variants override only the key accent variables.
   Default (no data-theme) == cyan */
:root[data-theme="cyan"] {
  --line: rgba(0, 229, 255, 0.25);
  --line-strong: rgba(0, 229, 255, 0.6);
  --primary: #00e5ff;
  --accent: #00bcd4;
  --glow: 0 0 10px rgba(0, 229, 255, 0.35), 0 0 22px rgba(0, 188, 212, 0.15);
}

:root[data-theme="blue"] {
  --line: rgba(3, 20, 250, 0.25);
  --line-strong: rgba(3, 19, 250, 0.459);
  --primary: #001aff;
  --accent: #0e00d4;
  --glow: 0 0 10px rgba(0, 38, 255, 0.35), 0 0 22px rgba(0, 14, 212, 0.15);
}

:root[data-theme="red"] {
  --line: rgba(250, 3, 3, 0.25);
  --line-strong: rgba(250, 3, 3, 0.459);
  --primary: #ff0000;
  --accent: #d40000;
  --glow: 0 0 10px rgba(255, 0, 0, 0.35), 0 0 22px rgba(212, 0, 0, 0.15);
}

:root[data-theme="violet"] {
  --line: rgba(162, 91, 255, 0.25);
  --line-strong: rgba(162, 91, 255, 0.6);
  --primary: #a25bff;
  --accent: #ff2bd6;
  --glow: 0 0 10px rgba(162, 91, 255, 0.35), 0 0 22px rgba(255, 43, 214, 0.15);
}

:root[data-theme="amber"] {
  --line: rgba(255, 193, 7, 0.25);
  --line-strong: rgba(255, 193, 7, 0.6);
  --primary: #ffc107;
  --accent: #ff9800;
  --glow: 0 0 10px rgba(255, 193, 7, 0.35), 0 0 22px rgba(255, 152, 0, 0.15);
}

:root[data-theme="green"] {
  --line: rgba(76, 175, 80, 0.25);
  --line-strong: rgba(76, 175, 80, 0.6);
  --primary: #4caf50;
  --accent: #00e676;
  --glow: 0 0 10px rgba(76, 175, 80, 0.35), 0 0 22px rgba(0, 230, 118, 0.15);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Cascadia Code", "Fira Code", monospace;
  color: var(--fg);
  /* Solid dark blue base; scanlines handled via overlay layer */
  background: var(--bg);
  position: relative;
}

/* Global themed scrollbars (WebKit/Blink + Firefox) */
/* Firefox */
* { scrollbar-width: thin; scrollbar-color: var(--sb-thumb) transparent; }
/* WebKit/Blink */
*::-webkit-scrollbar { width: var(--sb-size); height: var(--sb-size); }
*::-webkit-scrollbar-track { background: var(--sb-track); border: 1px solid var(--line); }
*::-webkit-scrollbar-thumb {
  background: var(--sb-thumb);
  border: 1px solid var(--line-strong);
  border-radius: 0; /* squared to match UI */
}
*::-webkit-scrollbar-thumb:hover { background: var(--sb-thumb-hover); }
*::-webkit-scrollbar-thumb:active { background: var(--sb-thumb-active); }

.page { height: 100vh; display: grid; grid-template-rows: auto 1fr auto; position: relative; z-index: 1; }

.header { text-align: center; padding: 28px 16px 8px; position: relative; }
.header h1 { margin: 0; letter-spacing: 1px; font-weight: 800; color: var(--fg); text-shadow: 0 0 8px var(--line-strong); }
.deck-title { font-size: calc(28px * 1.05); }
.cursor { color: var(--primary); animation: blink 1s steps(1, end) infinite; }
@keyframes blink { 50% { opacity: 0; } }
.tag { margin-top: 6px; color: var(--muted); font-size: 0.9rem; letter-spacing: 0.08em; }

.container {
  max-width: 1600px; margin: 0 auto; padding: 20px;
  display: grid; gap: 20px; grid-template-columns: 1fr;
  justify-items: center; align-self: stretch; overflow: hidden;
}

/* Main grid that holds the left timer stack and optional side notes pane */
.main-grid {
  display: grid;
  gap: 20px;
  grid-template-columns: 1fr auto; /* left + one side pane */
  align-items: start;
  justify-content: center;
  width: 100%;
}
/* when both notes and stats are open, show three columns */
.main-grid.notes-open.stats-open { grid-template-columns: 1fr auto auto; }
.main-left {
  display: grid; gap: 20px; align-content: start;
  max-width: 1000px; width: 100%; justify-self: center;
  transition: max-width .3s ease;
}
/* Keep left stack width stable; do not shrink on side panes */

/* Panels: squared edges, neon lines */
.glass {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: 0;
  box-shadow: var(--glow);
  position: relative;
}
.glass::before {
  content: "";
  position: absolute; inset: 0; pointer-events: none;
  background: linear-gradient(90deg, var(--line), transparent 20%, transparent 80%, var(--line));
}

/* global scanlines overlay */
.page::after {
  content: "";
  position: fixed; inset: 0; pointer-events: none;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.035) 0px,
    rgba(255,255,255,0.035) 1px,
    rgba(0,0,0,0) 3px,
    rgba(0,0,0,0) 4px
  );
  mix-blend-mode: overlay;
  opacity: var(--scanlines-opacity);
  animation: scan 6s linear infinite;
}
/* allow fully disabling scanlines via class */
.page.no-scanlines::after {
  opacity: 0 !important;
  animation: none !important;
}
@keyframes scan { to { background-position: 0 4px; } }

/* background canvas for falling glyphs */
.bg-canvas {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.16;
}

/* FX overlay canvas for transient effects (e.g., confetti) */
.fx-canvas {
  position: fixed; inset: 0; z-index: 40; pointer-events: none;
}

.clock-card { padding: 18px 24px; display: grid; gap: 6px; justify-items: center; width: 100%; max-width: 1000px; overflow: hidden; }
/* keep clock-card width stable */
.timer-card { padding: 24px; display: grid; gap: 16px; align-content: start; width: 100%; max-width: 1000px; }
/* keep timer-card width stable */
.notes { padding: 18px; display: grid; gap: 10px; width: 100%; max-width: 980px; }
.main-grid .notes { max-width: none; height: fit-content; }
.notes-collapsible {
  overflow: hidden;
  width: 0;
  opacity: 0;
  transform: translateX(12px);
  transition: width .35s ease, opacity .25s ease, transform .35s ease;
  pointer-events: none;
}
.notes-collapsible.open {
  width: min(45vw, 520px);
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
  overflow: auto;
}

/* Statistics panel mirrors notes behavior */
.stats { padding: 18px; display: grid; gap: 12px; width: 100%; max-width: 980px; }
.main-grid .stats { max-width: none; height: fit-content; }
.stats-collapsible {
  overflow: hidden;
  width: 0;
  opacity: 0;
  transform: translateX(12px);
  transition: width .35s ease, opacity .25s ease, transform .35s ease;
  pointer-events: none;
}
.stats-collapsible.open {
  width: min(45vw, 520px);
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}
.stats-title { margin: 0; font-size: 1.05rem; color: var(--primary); letter-spacing: 0.06em; font-weight: 800; }
.stats-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
.stat { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 10px; border: 1px solid var(--line); padding: 10px; background: #061427; }
.stat-label { color: var(--muted); font-weight: 700; letter-spacing: 0.05em; }
.stat-value { color: var(--fg); font-weight: 800; letter-spacing: 0.04em; }
.notes-title { margin: 0; font-size: 1.05rem; color: var(--primary); letter-spacing: 0.06em; font-weight: 800; }
.notes-subtitle { margin: 6px 0; font-size: 0.95rem; color: var(--muted); font-weight: 800; letter-spacing: 0.05em; }
.notes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
.notes-col { display: grid; gap: 8px; align-content: start; }
@media (max-width: 800px) { .notes-grid { grid-template-columns: 1fr; } }
.notes textarea {
  width: 100%;
  min-height: 120px;
  resize: vertical;
  padding: 12px;
  border: 1px solid var(--line);
  background: #071224;
  color: var(--fg);
  font-family: inherit;
  border-radius: 0;
  outline: none;
}
.notes textarea:focus { border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }
.notes-preview {
  border: 1px solid var(--line);
  background: #061427;
  padding: 12px;
  color: var(--fg);
  box-shadow: 0 0 8px var(--line) inset;
}
.notes-preview:empty::before {
  content: "live previewâ€¦";
  color: var(--muted);
}
.notes-actions { display: flex; gap: 10px; justify-content: flex-start; }
.notes-actions + .notes-actions { margin-top: 10px; }
.notes-footnote { font-size: 0.85rem; margin-top: 6px; }
.status-row { display: flex; align-items: center; justify-content: space-between; }
.badge {
  color: var(--fg);
  background: transparent;
  padding: 6px 12px;
  border: 1px solid var(--line-strong);
  border-radius: 0;
  font-weight: 700;
  font-family: inherit;
  box-shadow: 0 0 8px var(--line-strong) inset;
}
.badge.pulse, .badge.pulse-fast { transition: filter .22s ease; }
/* beat-driven pulse: stronger glow only while .page.beat is present */
.page.beat .badge.pulse, .page.beat .badge.pulse-fast {
  filter: drop-shadow(0 0 6px var(--primary)) drop-shadow(0 0 14px var(--primary));
}
.muted { color: var(--muted); }
.clock {
  font-size: clamp(120px, 16vw, 300px);
  line-height: 1; font-weight: 900; letter-spacing: 4px; text-align: center; padding: 18px 0 8px;
  color: var(--primary);
  /* keep a subtle local highlight; heavy glow comes from ::before */
  text-shadow: 0 0 3px var(--line-strong), 0 0 8px var(--line);
  position: relative;
  /* prevent inherited animation from adding drop-shadows directly on text */
  filter: none !important;
  max-width: 100%;
  white-space: nowrap;
}
.clock.pulse, .clock.pulse-fast { /* beat-driven via ::before; no CSS animation */ }
.clock.dim { opacity: 0.55; }
.clock::before {
  /* back-glow layer: sits behind the numerals */
  content: "";
  position: absolute; inset: -6px -12px; pointer-events: none;
  background: radial-gradient(ellipse at center, var(--line-strong) 0%, var(--line) 30%, rgba(0,0,0,0) 70%);
  filter: blur(22px);
  opacity: 0.45;
  z-index: -1;
  transition: opacity .22s ease, filter .22s ease;
}
/* heightened glow only during the global beat tick */
.page.beat .clock.pulse::before,
.page.beat .clock.pulse-fast::before {
  opacity: 0.85;
  filter: blur(26px);
}
.clock.overtime {
  color: var(--accent);
  text-shadow: 0 0 3px var(--line-strong), 0 0 10px var(--accent);
}
.clock::after {
  /* text-masked scanlines overlay: applies only to numerals */
  content: attr(data-text);
  position: absolute; inset: 0; pointer-events: none;
  /* match the base text box exactly to avoid double-image look */
  display: block;
  padding: inherit;
  font: inherit;
  letter-spacing: inherit;
  line-height: inherit;
  text-align: inherit;
  color: transparent;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.06) 0px,
    rgba(255,255,255,0.06) 1px,
    rgba(0,0,0,0) 3px,
    rgba(0,0,0,0) 6px
  );
  -webkit-background-clip: text;
  background-clip: text;
  mix-blend-mode: overlay;
  animation: scan 7s linear infinite;
}
.message { text-align: center; min-height: 20px; color: var(--primary); }

/* subtle overtime badge */
.status-right { display: flex; align-items: center; gap: 10px; }
.overtime-pill {
  display: none;
  margin: 0;
  padding: 3px 10px;
  border: 1px solid var(--accent);
  color: var(--accent);
  background: rgba(0, 0, 0, 0.25);
  font-size: 0.8rem;
  font-weight: 800;
  letter-spacing: 0.08em;
  text-transform: lowercase;
  box-shadow: 0 0 6px color-mix(in srgb, var(--accent) 60%, transparent) inset;
  animation: otPulse 2.2s ease-in-out infinite;
  pointer-events: none;
}
.overtime-pill.show { display: inline-block; }
@keyframes otPulse {
  0%, 100% { opacity: 0.72; }
  50% { opacity: 1; }
}

.controls { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
@media (max-width: 600px) { .controls { grid-template-columns: repeat(2, 1fr); } }

.btn {
  appearance: none; cursor: pointer;
  border: 1px solid var(--line);
  background: #061427;
  color: var(--fg);
  padding: 11px 12px;
  border-radius: 0;
  font-weight: 700;
  font-family: inherit;
  letter-spacing: 0.04em;
  transition: box-shadow .15s ease, transform .03s ease, background .2s ease, border-color .2s ease;
  box-shadow: none;
}
.btn:hover { border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }
.btn:active { transform: translateY(1px); }
.btn.primary {
  background: linear-gradient(90deg, var(--line), var(--line));
  border-color: var(--line-strong);
}
.btn.danger {
  background: rgba(0, 10, 31, 0.8);
  background: color-mix(in srgb, var(--accent) 8%, #0a0f1f);
  border-color: var(--accent);
  color: var(--fg);
  box-shadow: 0 0 8px var(--accent) inset;
}
.btn:disabled { opacity: 0.5; cursor: not-allowed; }

.settings { padding: 20px; }
.settings h2 { margin: 0 0 10px; font-size: 1.05rem; color: var(--primary); text-transform: none; letter-spacing: 0.06em; font-weight: 800; }
.settings form { display: grid; gap: 12px; grid-template-columns: repeat(2, 1fr); }
.settings label { display: grid; gap: 6px; font-size: 0.9rem; color: var(--muted); }
.settings label.danger {
  border: 1px solid var(--accent);
  padding: 10px;
  background: color-mix(in srgb, var(--accent) 8%, #0a0f1f);
  box-shadow: 0 0 8px var(--accent) inset;
}
.settings input {
  width: 100%; padding: 10px 12px; border-radius: 0;
  border: 1px solid var(--line);
  background: #071224; color: var(--fg);
  outline: none;
  font-family: inherit;
}
.settings input[type="number"] {
  /* remove native spinners for a cleaner, themed look */
  -moz-appearance: textfield;
  appearance: textfield;
}
.settings input[type="number"]::-webkit-outer-spin-button,
.settings input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.settings input:focus { border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }
.settings button { justify-self: start; margin-top: 8px; }

.settings select {
  width: 100%; padding: 10px 12px; border-radius: 0;
  border: 1px solid var(--line);
  background: #071224; color: var(--fg);
  outline: none;
  font-family: inherit;
}
.settings select:focus { border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }

/* Themed controls: range + checkbox */
.settings input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 4px;
  background: color-mix(in srgb, var(--line) 70%, transparent);
  border-radius: 2px;
  outline: none;
  border: 1px solid var(--line);
}
.settings input[type="range"]:focus { border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }
.settings input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--primary);
  border: 1px solid var(--line-strong);
  box-shadow: 0 0 6px var(--line-strong);
  cursor: pointer;
}
.settings input[type="range"]::-moz-range-thumb {
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--primary);
  border: 1px solid var(--line-strong);
  box-shadow: 0 0 6px var(--line-strong);
  cursor: pointer;
}
.settings input[type="range"]::-moz-range-track {
  height: 4px; background: color-mix(in srgb, var(--line) 70%, transparent);
  border: 1px solid var(--line);
  border-radius: 2px;
}
.settings input[type="range"]:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; }

.settings input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 18px; height: 18px;
  display: inline-block;
  position: relative;
  vertical-align: middle;
  border: 1px solid var(--line);
  background: #071224;
  border-radius: 2px;
  cursor: pointer;
  transition: box-shadow .15s ease, border-color .15s ease, background .2s ease;
}
.settings input[type="checkbox"]:hover { border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }
.settings input[type="checkbox"]:focus { outline: none; border-color: var(--line-strong); box-shadow: 0 0 8px var(--line-strong); }
.settings input[type="checkbox"]:checked {
  background: var(--primary);
  border-color: var(--line-strong);
  box-shadow: 0 0 6px var(--line-strong) inset;
}
.settings input[type="checkbox"]::after {
  content: "";
  position: absolute;
  left: 50%; top: 50%;
  width: 8px; height: 12px;
  border: 2px solid #001018;
  border-top: 0; border-left: 0;
  transform: translate(-50%, -58%) rotate(45deg);
  opacity: 0;
  pointer-events: none;
}
.settings input[type="checkbox"]:checked::after { opacity: 1; }
.settings input[type="checkbox"]:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; }

/* modal bottom sheet */
.modal {
  position: fixed; inset: 0; display: flex; align-items: flex-end; justify-content: center;
  background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.55) 60%);
  visibility: hidden; opacity: 0; pointer-events: none;
  transition: opacity .2s ease, visibility .2s ease;
  z-index: 50;
}
.modal.open { visibility: visible; opacity: 1; pointer-events: auto; }
.modal-sheet {
  width: 100%; max-width: 980px; border-top: 1px solid var(--line);
  transform: translateY(100%);
  transition: transform .25s ease;
}
.modal.open .modal-sheet { transform: translateY(0); }

/* Centered modal variant for notes */
.modal.center { align-items: center; }
.modal.center .modal-sheet {
  border-top: none;
  transform: scale(0.98);
  max-height: 88vh;
  overflow: auto;
}
.modal.center.open .modal-sheet { transform: scale(1); }

.footer { text-align: center; padding: 16px; color: var(--muted); font-size: 0.9rem; letter-spacing: 0.05em; }
.footer a { color: var(--primary); text-decoration: none; }
.footer a:hover { text-decoration: underline; }

/* Arrow rotation for notes button */
#open-notes .arrow { display: inline-block; }
#open-notes.open .arrow { /* arrow text toggled via JS; no rotation */ }

/* Basic markdown body styling in preview */
.markdown-body { line-height: 1.55; }
.markdown-body h1, .markdown-body h2, .markdown-body h3,
.markdown-body h4, .markdown-body h5, .markdown-body h6 {
  margin: 0.8em 0 0.4em; font-weight: 800; color: var(--primary);
}
.markdown-body p { margin: 0.6em 0; }
.markdown-body a { color: var(--primary); text-decoration: none; border-bottom: 1px dotted var(--line-strong); }
.markdown-body a:hover { text-decoration: underline; }
.markdown-body code { background: #0a172b; padding: 0 4px; border: 1px solid var(--line); }
.markdown-body pre { background: #0a172b; padding: 10px; overflow: auto; border: 1px solid var(--line); }
.markdown-body pre code { background: transparent; border: none; padding: 0; }
.markdown-body ul, .markdown-body ol { padding-left: 1.4em; margin: 0.4em 0; }
.markdown-body blockquote { margin: 0.6em 0; padding-left: 1em; border-left: 3px solid var(--line-strong); color: var(--primary); }
.markdown-body hr { border: none; height: 1px; background: var(--line); margin: 1em 0; }

/* Left-side controls drawer */
.controls-drawer {
  position: fixed;
  top: 70px; bottom: 70px; left: 0;
  width: 0; /* animate width like notes */
  background: var(--panel);
  border-right: 1px solid var(--line);
  box-shadow: 8px 0 20px rgba(0,0,0,0.4), var(--glow);
  opacity: 0;
  transform: translateX(-12px);
  transition: width .35s ease, opacity .25s ease, transform .35s ease;
  z-index: 45;
  display: grid;
  grid-template-rows: auto auto 1fr;
  overflow: hidden; /* prevent peeking while closed */
  padding-left: var(--drawer-left-pad, 44px); /* keep content clear of the fixed controls tab */
  pointer-events: none;
}
.controls-drawer.open {
  width: min(90vw, 440px);
  opacity: 1;
  transform: translateX(0);
  overflow: auto;
  pointer-events: auto;
}
.drawer-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 12px; border-bottom: 1px solid var(--line); }
.drawer-title { margin: 0; font-size: 1rem; color: var(--primary); letter-spacing: 0.06em; font-weight: 800; }
.drawer-close { padding: 6px 10px; }
.controls-drawer .controls { padding: 12px; display: grid; grid-template-columns: 1fr; gap: 10px; align-content: start; overflow: auto; }

/* Drawer sections (collapsible) */
.drawer-section { border-top: 1px solid var(--line); }
.drawer-collapsible {
  display: none; /* removed from layout while collapsed */
  overflow: hidden;
  height: 0; /* animate height for smooth rollout */
  opacity: 0;
  transform: translateY(-8px);
  transition: height .35s ease, opacity .25s ease, transform .35s ease;
  pointer-events: none;
}
.drawer-collapsible.open {
  /* JS manages display:block and height during animation */
  height: auto; /* ensure it stays open after we clear inline height */
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

/* Toggle tab */
.controls-toggle {
  position: fixed;
  left: 0; top: 50%; transform: translateY(-50%);
  padding: 10px 12px;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  border-right: 1px solid var(--line-strong);
  border-left: none;
  background: linear-gradient(90deg, var(--line), var(--line));
  border-color: var(--line-strong);
  color: var(--fg);
  z-index: 46;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transition: none; /* prevent janky movement */
}
.controls-toggle.open { box-shadow: 0 0 8px var(--line-strong); }
.controls-toggle:active { transform: translateY(-50%); }

/* Make sure base grid for old .controls doesn't override drawer layout */
.controls-drawer .controls .btn { width: 100%; justify-self: stretch; }
